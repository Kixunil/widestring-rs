<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `widestring` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, widestring">

    <title>widestring - Rust</title>

    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'></p><script>window.sidebarCurrent = {name: 'widestring', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Crate <a class='mod' href=''>widestring</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a id='src-0' class='srclink' href='../src/widestring/src/lib.rs.html#1-164' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>A wide string FFI library for converting to and from Windows Wide &quot;Unicode&quot; strings.</p>

<p>This crate provides two types of wide strings: <code>WideString</code> and <code>WideCString</code>. They differ
in the guaruntees they provide. For <code>WideString</code>, no guaruntees are made about the underlying
string data; it is simply a sequence of UTF-16 <em>partial code units</em>, which may be ill-formed or
contain nul values. <code>WideCString</code> on the other hand is aware of nul values and is guarunteed to
be terminated with a nul value (unless unchecked methods are used to construct the
<code>WideCString</code>). Because <code>WideCString</code> is a C-style, nul-terminated string, it will have no
interior nul values. A <code>WideCString</code> may still have ill-formed UTF-16 partial code units.</p>

<p>Use <code>WideString</code> when you simply need to pass-thru strings, or when you know or don&#39;t care if
you&#39;re not dealing with a nul-terminated string, such as when string lengths are provided and
you are only reading strings from FFI, not passing them into FFI.</p>

<p>Use <code>WideCString</code> when you must properly handle nul values, and must deal with nul-terminated
C-style wide strings, such as if you must pass strings into FFI functions.</p>

<h1 id='relationship-to-other-rust-strings' class='section-header'><a href='#relationship-to-other-rust-strings'>Relationship to other Rust Strings</a></h1>
<p>Standard Rust strings <code>String</code> and <code>str</code> are well-formed Unicode data encoded as UTF-8. The
standard strings provide proper handling of Unicode and ensure strong safety guaruntees.</p>

<p><code>CString</code> and <code>CStr</code> are strings used for C FFI. They handle nul-terminated C-style strings.
However, they do not have a builtin encoding, and conversions between C-style and other Rust
strings must specifically encode and decode the strings, and handle possible invalid encoding
data. They are safe to use only in passing string-like data back and forth from C APIs but do
do provide any other guaruntees, so may not be well-formed.</p>

<p><code>OsString</code> and <code>OsStr</code> are also strings for use with FFI. Unlike <code>CString</code>, they do no special
handling of nul values, but instead have an OS-specified encoding. While, for example, Linux
systems this is usually UTF-8 encoding, this is not the case for every platform. The encoding
may not even be 8-bit: on Windows, <code>OsString</code> is 16-bit values, but may not always be
interpreted with UTF-16 encoding. Like <code>CString</code>, <code>OsString</code> has no additional
guaruntees and may not be well-formed.</p>

<p>Due to the looser safety of these other string types, conversion to standard Rust <code>String</code> is
lossy, and may require knowledge of the underlying encoding, including platform-specific quirks.</p>

<p>The wide strings in this crate are roughly based on the principles of the string types in
<code>std::ffi</code>, though there are differences. <code>WideString</code> and <code>WideStr</code> are roughly similar in role
to <code>OsString</code> and <code>OsStr</code>, while <code>WideCString</code> and <code>WideCStr</code> are roughly similar in role to
<code>CString</code> and <code>CStr</code>. In fact, on Windows, <code>WideString</code> is nearly identical to <code>OsString</code>. It
can be useful to ensure consistent wide character size across other platforms, and that&#39;s where
these wide string types come into play. Conversion to other string types is very straight
forward and safe, while conversion directly between standard Rust <code>String</code> is a lossy conversion
just as <code>OsString</code> is, where the wide strings are assumed to have some sort of UTF-16 encoding,
but that encoding may be ill-formed.</p>

<h1 id='remarks-on-partial-code-units' class='section-header'><a href='#remarks-on-partial-code-units'>Remarks on Partial Code Units</a></h1>
<p><em>Partial code units</em> are the 16-bit units that comprise UTF-16 sequences. Partial code units
can specify Unicode code points either as single units or in <em>surrogate pairs</em>. Because every
partial code unit may be part of a surrogate pair, many regular string operations, including
indexing into a wide string, writing to a wide string, or even iterating a wide string should be
handled with care and are greatly discouraged. Some operations have safer alternatives provided,
such as code point iteration instead of partial code unit iteration. Always keep in mind that
the number of partial code units (<code>len()</code>) of a wide string is <strong>not</strong> equivalent to the
number of Unicode characters in the string, merely the length of the UTF-16 encoding sequence.
In fact, Unicode code points do not even have a one-to-one mapping with characters!</p>

<h1 id='examples' class='section-header'><a href='#examples'>Examples</a></h1>
<p>The following example uses <code>WideString</code> to get windows error messages, since <code>FormatMessageW</code>
returns a string length for us, and we don&#39;t need to pass error messages into other FFI
functions so we don&#39;t need to worry about nuls.</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>winapi</span>::<span class='op'>*</span>;
<span class='kw'>use</span> <span class='ident'>kernel32</span>::{<span class='ident'>FormatMessageW</span>, <span class='ident'>LocalFree</span>};
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>ptr</span>;
<span class='kw'>use</span> <span class='ident'>widestring</span>::<span class='ident'>WideString</span>;

<span class='kw'>let</span> <span class='ident'>widestr</span>: <span class='ident'>WideString</span>;
<span class='kw'>unsafe</span> {
    <span class='comment'>// First, get a string buffer from some windows api such as FormatMessageW...</span>
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>buffer</span>: <span class='ident'>LPWSTR</span> <span class='op'>=</span> <span class='ident'>ptr</span>::<span class='ident'>null_mut</span>();
    <span class='kw'>let</span> <span class='ident'>strlen</span> <span class='op'>=</span> <span class='ident'>FormatMessageW</span>(<span class='ident'>FORMAT_MESSAGE_FROM_SYSTEM</span> <span class='op'>|</span>
                                <span class='ident'>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class='op'>|</span>
                                <span class='ident'>FORMAT_MESSAGE_IGNORE_INSERTS</span>,
                                <span class='ident'>ptr</span>::<span class='ident'>null</span>(),
                                <span class='ident'>error_code</span>, <span class='comment'>// error code from GetLastError()</span>
                                <span class='number'>0</span>,
                                (<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>buffer</span> <span class='kw'>as</span> <span class='op'>*</span><span class='kw-2'>mut</span> <span class='ident'>LPWSTR</span>) <span class='kw'>as</span> <span class='ident'>LPWSTR</span>,
                                <span class='number'>0</span>,
                                <span class='ident'>ptr</span>::<span class='ident'>null_mut</span>());

    <span class='comment'>// Get the buffer as a wide string</span>
    <span class='ident'>widestr</span> <span class='op'>=</span> <span class='ident'>WideString</span>::<span class='ident'>from_ptr</span>(<span class='ident'>buffer</span>, <span class='ident'>strlen</span> <span class='kw'>as</span> <span class='ident'>usize</span>);
    <span class='comment'>// Since WideString creates an owned copy, it&#39;s safe to free original buffer now</span>
    <span class='comment'>// If you didn&#39;t want an owned copy, you could use &amp;WideStr.</span>
    <span class='ident'>LocalFree</span>(<span class='ident'>buffer</span> <span class='kw'>as</span> <span class='ident'>HLOCAL</span>);
}
<span class='comment'>// Convert to a regular Rust String and use it to your heart&#39;s desire!</span>
<span class='kw'>let</span> <span class='ident'>message</span> <span class='op'>=</span> <span class='ident'>widestr</span>.<span class='ident'>to_string_lossy</span>();</pre>

<p>The following example is the functionally the same, only using <code>WideCString</code> instead.</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>winapi</span>::<span class='op'>*</span>;
<span class='kw'>use</span> <span class='ident'>kernel32</span>::{<span class='ident'>FormatMessageW</span>, <span class='ident'>LocalFree</span>};
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>ptr</span>;
<span class='kw'>use</span> <span class='ident'>widestring</span>::<span class='ident'>WideCString</span>;

<span class='kw'>let</span> <span class='ident'>widestr</span>: <span class='ident'>WideCString</span>;
<span class='kw'>unsafe</span> {
    <span class='comment'>// First, get a string buffer from some windows api such as FormatMessageW...</span>
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>buffer</span>: <span class='ident'>LPWSTR</span> <span class='op'>=</span> <span class='ident'>ptr</span>::<span class='ident'>null_mut</span>();
    <span class='ident'>FormatMessageW</span>(<span class='ident'>FORMAT_MESSAGE_FROM_SYSTEM</span> <span class='op'>|</span>
                   <span class='ident'>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class='op'>|</span>
                   <span class='ident'>FORMAT_MESSAGE_IGNORE_INSERTS</span>,
                   <span class='ident'>ptr</span>::<span class='ident'>null</span>(),
                   <span class='ident'>error_code</span>, <span class='comment'>// error code from GetLastError()</span>
                   <span class='number'>0</span>,
                   (<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>buffer</span> <span class='kw'>as</span> <span class='op'>*</span><span class='kw-2'>mut</span> <span class='ident'>LPWSTR</span>) <span class='kw'>as</span> <span class='ident'>LPWSTR</span>,
                   <span class='number'>0</span>,
                   <span class='ident'>ptr</span>::<span class='ident'>null_mut</span>());

    <span class='comment'>// Get the buffer as a wide string</span>
    <span class='ident'>widestr</span> <span class='op'>=</span> <span class='ident'>WideCString</span>::<span class='ident'>from_ptr_str</span>(<span class='ident'>buffer</span>);
    <span class='comment'>// Since WideCString creates an owned copy, it&#39;s safe to free original buffer now</span>
    <span class='comment'>// If you didn&#39;t want an owned copy, you could use &amp;WideCStr.</span>
    <span class='ident'>LocalFree</span>(<span class='ident'>buffer</span> <span class='kw'>as</span> <span class='ident'>HLOCAL</span>);
}
<span class='comment'>// Convert to a regular Rust String and use it to your heart&#39;s desire!</span>
<span class='kw'>let</span> <span class='ident'>message</span> <span class='op'>=</span> <span class='ident'>widestr</span>.<span class='ident'>to_string_lossy</span>();</pre>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.MissingNulError.html'
                                  title='widestring::MissingNulError'>MissingNulError</a></td>
                           <td class='docblock short'>
                                <p>An error returned from <code>WideCString</code> and <code>WideCStr</code> to indicate that a terminating nul value
was missing.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.NulError.html'
                                  title='widestring::NulError'>NulError</a></td>
                           <td class='docblock short'>
                                <p>An error returned from <code>WideCString</code> to indicate that an invalid nul value was found.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.WideCStr.html'
                                  title='widestring::WideCStr'>WideCStr</a></td>
                           <td class='docblock short'>
                                <p>C-style wide string reference for <code>WideCString</code>.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.WideCString.html'
                                  title='widestring::WideCString'>WideCString</a></td>
                           <td class='docblock short'>
                                <p>An owned, mutable C-style &quot;wide&quot; string for windows FFI that is nul-aware and nul-terminated.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.WideStr.html'
                                  title='widestring::WideStr'>WideStr</a></td>
                           <td class='docblock short'>
                                <p>Wide string reference for <code>WideString</code>.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.WideString.html'
                                  title='widestring::WideString'>WideString</a></td>
                           <td class='docblock short'>
                                <p>An owned, mutable &quot;wide&quot; string for windows FFI that is <strong>not</strong> nul-aware.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "widestring";
        window.playgroundUrl = "";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    
    <script defer src="../search-index.js"></script>
</body>
</html>